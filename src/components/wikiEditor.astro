---
import { contentsgarten } from '$constants/contentsgarten'

export interface Props {
  pageRef: string
  file: {
    path: string
    content: string
    revision?: string | undefined
  }
}

const { pageRef, file } = Astro.props

const editable = Astro.cookies.get('authgarten').value
  ? await contentsgarten(Astro.cookies.get('authgarten').value)
      .getEditPermission.query({
        pageRef,
      })
      .then(o => o.granted)
  : false
---

<div class="-mx-6 sm:mx-auto max-w-6xl">
  <div class="px-6 pb-10">
    <h1 class="mb-2 text-3xl">
      Editing <span class="font-medium">{pageRef}</span>
    </h1>
    {editable ? (
      <p>(The editor is quite janky, so please save your changes regularly!)</p>
    ) : (
      <p>
        (Editor is locked to read-only mode because you don't have enough
        permissions to edit the page)
      </p>
    )}
    <form class="py-4" method="POST">
      <input type="hidden" name="pageRef" value={pageRef} />
      <input type="hidden" name="revision" value={file?.revision} />
      <textarea
        name="content"
        class={`w-full p-4 font-mono text-sm rounded-xl ${
          editable ? 'whitespace-nowrap' : ''
        }`}
        disabled={!editable}
        {/* prettier-ignore */}
        rows={40}>{file?.content}</textarea
      >
      <button type="submit">SAVE</button>
    </form>
  </div>
</div>
