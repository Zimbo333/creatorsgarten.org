---
import AuthButton from '../components/authButton.astro'
import Blank from './blank.astro'

import './base.css'
import { getWebsiteConfig } from '$functions/getWebsiteConfig'
import { Icon } from 'react-iconify-icon-wrapper'

export interface Props {
  class?: string
}

const websiteConfig = await getWebsiteConfig()
const activeAnnouncement = (() => {
  const announcements = websiteConfig?.announcements ?? {}
  const preview = Astro.url.searchParams.get('previewAnnouncement')
  if (preview) {
    return announcements[preview]
  }
  return Object.values(announcements).find(announcement => {
    if (!announcement.enabled) return false
    if (announcement.start && new Date() < new Date(announcement.start)) {
      return false
    }
    if (announcement.end && new Date() > new Date(announcement.end)) {
      return false
    }
    return true
  })
})()
---

<Blank>
  {
    !!activeAnnouncement && (
      <a
        class="block bg-black px-6 py-4 text-white text-sm sm:text-base"
        href={activeAnnouncement.link}
      >
        <Icon icon="mdi:megaphone" inline /> {activeAnnouncement.message}
      </a>
    )
  }
  <nav class="grid sm:flex grid-cols-2 justify-between px-6 pt-6 pb-8">
    <a href="/" aria-label="back to home">
      <img
        src="/images/creatorsgarten.svg"
        width={888}
        height={398}
        class="w-auto h-9"
        alt="garten"
      />
    </a>
    <button
      class="sm:hidden text-3xl ml-auto"
      onclick="let m=document.getElementById('nav-menu');m.classList.toggle('block');m.classList.toggle('hidden');"
      >üçî</button
    >
    <!-- TODO: Delete this -->
    <div
      id="nav-menu"
      class="hidden col-span-2 sm:col-span-1 w-full pt-6 sm:p-0 sm:w-auto sm:flex items-center sm:space-x-4 font-medium text-sm ml-auto"
    >
      <ul
        class="grid grid-cols-2 gap-2 sm:flex shrink-0 sm:space-x-4 rounded-full sm:bg-[#ededed] py-2 px-4 mb-2 sm:mb-0"
      >
        <li class="hover:text-sky-600 transition-all">
          <a href="/events">CRAFTS</a>
        </li>
        <!-- <li class="hover:text-sky-600 transition-all">CONTENT</li> -->
        <li class="hover:text-sky-600 transition-all">
          <a href="/people">PEOPLE</a>
        </li>
        <!-- <li class="hover:text-sky-600 transition-all">US</li> -->
        <li class="hover:text-sky-600 transition-all">
          <a href="/wiki">WIKI</a>
        </li>
      </ul>
      <AuthButton />
    </div>
  </nav>

  <main {...{ class: ' ' + Astro.props.class ?? '' }}>
    <slot />
  </main>

  <footer class="bg-[#ededed] py-12 font-medium uppercase">
    <div class="mx-auto max-w-7xl w-full md:flex justify-between px-8">
      <section
        class="grid w-full md:max-w-[60%] grid-cols-2 sm:grid-cols-4 gap-8"
      >
        <div>
          <h1>Crafts</h1>
          <ul class="pt-1 font-normal">
            <li><a href="/events">Events</a></li>
            <li>Projects</li>
          </ul>
        </div>
        <div>
          <h1>Content</h1>
          <ul class="pt-1 font-normal">
            <li><a href="https://www.youtube.com/@creatorsgarten">Video</a></li>
            <li>Podcast</li>
            <li>RSS feed</li>
          </ul>
        </div>
        <div>
          <h1>People</h1>
          <ul class="pt-1 font-normal">
            <li><a href="/people">Us & Partners</a></li>
            <li>Sponsors</li>
            <li><a href="/wiki/Ring">Webring</a></li>
          </ul>
        </div>
        <div>
          <h1>Us</h1>
          <ul class="pt-1 font-normal">
            <li>About</li>
            <li><a href="mailto:mail@creatorsgarten.org">Contact</a></li>
            <li>Legal</li>
          </ul>
        </div>
      </section>
      <section class="flex flex-col items-end pt-10 md:pt-0">
        <a href="/" aria-label="back to home">
          <img
            src="/images/creatorsgarten.svg"
            width={888}
            height={398}
            alt="garten"
            class="h-10 mb-4 w-auto"
          />
        </a>
        <p class="text-right text-sm">MADE WITH THE ‚ù§Ô∏è OF ü™Ñ</p>
      </section>
    </div>
  </footer>
</Blank>
