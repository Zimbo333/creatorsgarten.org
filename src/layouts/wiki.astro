---
import dayjs from 'dayjs'

import BaseLayout from './base.astro'

import MetadataTable from '$components/metadataTable.astro'

export interface Props {
  title: string
  type?: 'page' | 'event'
  event?: {
    id: string
    location: string
    date: {
      from: Date
      to?: Date
    }
    hosts: string[]
  }
  contents: {
    id: string
    label: string
  }[]
  metadata: {
    edited: {
      at: Date
      by: string
    }
  }
}

const stringifyDate = (input: Date) => dayjs(input).format('D MMMM YYYY')

const { title, contents, event, metadata, type = 'page', content } = Astro.props
---

<BaseLayout>
  <h1 class="pt-6 pb-8 text-center text-5xl uppercase">{title}</h1>
  <div
    class="grid divide-x divide-[#ededed] border-[#ededed] border-t sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-5"
  >
    <div class="col-span-1 divide-y divide-[#ededed]">
      {
        type === 'event' && event && (
          <>
            <img
              src={`/images/events/${event.id}.png`}
              class="aspect-square w-full"
            />
            <section class="p-6">
              <h2 class="pb-6 text-center font-medium">EVENTS</h2>
              <MetadataTable
                data={[
                  ['LOCATION', event.location],
                  [
                    'DATE',
                    [
                      `${event.date.to ? 'FROM ' : ''}${stringifyDate(
                        event.date.from
                      )}`,
                      ...(event.date.to
                        ? [`TO ${stringifyDate(event.date.to)}`]
                        : []),
                    ],
                  ],
                  ['HOST', event.hosts.map(o => `[${o}]`).join(' ')],
                ]}
              />
            </section>
          </>
        )
      }
      {
        contents.length > 0 && (
          <section class="p-6">
            <h2 class="pb-6 text-center font-medium">CONTENTS</h2>
            <ul class="list-inside list-disc text-sm">
              {contents.map(content => (
                <li>
                  <a href={'#' + content.id}>{content.label}</a>
                </li>
              ))}
            </ul>
          </section>
        )
      }
      <section class="p-6">
        <h2 class="pb-6 text-center font-medium">METADATA</h2>
        <MetadataTable
          data={[
            [
              'EDIT',
              `${stringifyDate(metadata.edited.at)} / ${metadata.edited.by}`,
            ],
          ]}
        />
      </section>
      <section class="p-6">
        <h2 class="pb-6 text-center font-medium">SHARE</h2>
      </section>
    </div>
    <div
      class="col-span-1 px-12 py-10 sm:col-span-2 md:col-span-3 xl:col-span-4"
    >
      <article class="text-[0.8en] prose mx-auto max-w-6xl">
        <slot />
      </article>
    </div>
  </div>
</BaseLayout>
