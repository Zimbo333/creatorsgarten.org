---
import BaseLayout from '$layouts/base.astro'
import Head from '$components/head.astro'
import { getBackend } from '$functions/getBackend'
import { Icon } from 'react-iconify-icon-wrapper'

const authenticatedUser = await getBackend(
  Astro
).auth.getAuthenticatedUser.query()
if (!authenticatedUser) return Astro.redirect('/')
---

<Head title="Dashboard" />

<BaseLayout class="max-w-7xl mx-auto space-y-6 [&>*]:px-6">
  <section class="max-w-lg mx-auto">
    <div
      class="flex bg-white border border-neutral-300 rounded-2xl p-4 space-x-4"
    >
      <img
        src={authenticatedUser.avatar}
        class="w-24 h-24 rounded-full shrink-0"
      />
      <div class="py-2 pr-2 flex flex-col justify-center">
        <h1 class="font-medium text-lg leading-tight mb-1 md:mb-0">
          {authenticatedUser.name}
        </h1>
        <p>{authenticatedUser.email}</p>
      </div>
    </div>
  </section>
  <section class="max-w-sm md:max-w-2xl mx-auto">
    <div
      class="bg-gradient-to-b from-[#73A790] from-5% to-[#2E6459] w-full aspect-square md:aspect-auto rounded-2xl flex flex-col justify-between text-white p-6 leading-none border border-neutral-500"
    >
      <div class="text-2xl">
        <h1 class="font-medium">GARDEN ZERO</h1>
        <h1 class="-mt-2">access card</h1>
        <img src="/images/g0-org.png" class="h-6 w-auto mt-2" />
      </div>
      <div>
        <div class="text-2xl mb-3 uppercase md:mt-10">
          <div class="md:flex">
            <h1 class="font-medium">{authenticatedUser.name.split(' ')[0]}</h1>
            <h1 class="-mt-1 mb-2 md:my-0 md:ml-3 truncate">
              {authenticatedUser.name.split(' ').slice(1).join(' ')}
            </h1>
          </div>
          <div class="w-6 h-[0.1rem] bg-white md:mt-1"></div>
        </div>
        <div class="flex justify-between items-center text-base">
          <h1>{authenticatedUser.uid}</h1>
          <h1 class="font-medium text-base">GENERATE QR â†’</h1>
        </div>
      </div>
    </div>
  </section>
  <section class="max-w-2xl mx-auto">
    <div class="bg-white rounded-2xl py-6 px-8 border border-neutral-300">
      <h1 class="font-medium text-xl uppercase pb-4 text-center">
        Connections
      </h1>
      <div class="flex justify-between items-center">
        <div class="leading-none">
          <p class="inline-flex items-center text-lg font-medium">GitHub</p>
          <p class="text-sm -mt-1">
            {
              authenticatedUser.connections.github
                ? 'Connected with @' +
                  authenticatedUser.connections.github.username
                : 'Not connected'
            }
          </p>
        </div>
        <a
          href="/auth/connect/github"
          class="uppercase py-2 px-4 rounded-lg bg-neutral-700 text-white"
          >{authenticatedUser.connections.github ? 'Reconnect' : 'Connect'}</a
        >
      </div>
    </div>
  </section>
  <div class="pb-6"></div>
</BaseLayout>
